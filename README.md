
## Discordテキスト読み上げBotの使い方

## 仕様

### 概要

このBotは、Discordのテキストチャンネルのメッセージを読み上げるBotです。 AIVIS Speech APIを利用して音声合成を行い、指定されたボイスチャンネルで読み上げます。 APIが利用できない場合は、gTTS (Google Text-to-Speech) にフォールバックします。

### 動作環境

*   Python 3.7以上
*   discord.py, gTTS, aiohttp, python-dotenvライブラリ

### 機能

*   テキストチャンネルのメッセージ読み上げ
*   ボイスチャンネルへの参加・退出
*   AIVIS Speech APIまたはgTTSによる音声合成
*   ボイスチャンネルへの入退室アナウンス
* 　長いテキストの場合は途中で切り数て

### 注意事項

*   Discord Botに必要な権限が付与されていること
*   AIVIS Speech APIが利用できない場合はgTTSが使用されること
*   メッセージの文字数制限を超えた場合、メッセージが省略される場合があること

### 準備

1.  **Python環境の構築**:
    *   Python 3.7以上がインストールされていることを確認してください。
    *   必要なライブラリをインストールします。

    ```bash
    pip install discord.py gTTS aiohttp python-dotenv
    ```

2.  **Botのトークンを取得**:
    *   Discord Developer PortalでBotを作成し、トークンを取得してください。

3.  **環境変数の設定**:
    *   Botへトークンを設定します。

    bot.pyの256行目
    ```
    asyncio.run(bot.start('BOT_TOKEN'))
    ```
    のところにBOT_TOKENを入力して下さい

## 起動方法

1.  **音声生成サーバーの起動**:
    *   [aivisspeech-engine](https://github.com/Aivis-Project/AivisSpeech-Engine)をダウンロードし実行します。

    起動したサーバーでhttp://localhost:10101にアクセスできることを確認して下さい

2.  **Botの起動**:
    *   bot.pyを実行します。

    ```bash
    python bot.py
    ```

### コマンド

*   **/join**: ボイスチャンネルに参加し、テキスト読み上げを開始します。
    *   コマンドを実行したユーザーが参加しているボイスチャンネルにBotが参加します。
    *   以降、テキストチャンネルに投稿されたメッセージが読み上げられます。
*   **/leave**: ボイスチャンネルから退出します。
    *   Botが参加しているボイスチャンネルから退出します。
    *   テキスト読み上げを終了します。

### 設定

*   **読み上げ対象チャンネル**:
    *   `/join`コマンドを実行したテキストチャンネルが読み上げ対象となります。
*   **読み上げ対象チャンネル**:
    *   `/leave`コマンドを実行するとVCから切断されます
*   **話者ID**:
    *   bot.py内の`self.speaker_id = 888753760`で設定します。必要に応じて変更してください。

### オプション機能
*   **AIVIS Speech APIのエンドポイント**:
    *   aivis_speech_util.py内の`self.endpoints`で設定します。
    ```
    self.endpoints = endpoints or [
        "http://localhost:10101",
        "http://192.168.2.100:10101",
        "http://192.168.2.101:10101",
    ]
    ```
    このように追加していくとサーバーの負荷分散が実行されます。
    大規模　複数サーバーに導入する場合はサーバーを複数台用意することをお勧めします


### 注意点

*   Botが正常に動作するためには、Botに適切な権限が必要です。
    *   ボイスチャンネルへの接続、メッセージの読み取り、メッセージの送信などの権限を付与してください。
*   AIVIS Speech APIが利用できない場合、gTTSによる読み上げに切り替わります。
    *   gTTSの利用には、インターネット接続が必要です。
*   メッセージの文字数制限を超えた場合、メッセージが省略される場合があります。
*   Botが予期せぬ動作をした場合は、ログを確認してください。

## ライセンスについて

本リポジトリのコードは MIT License (または Apache License 2.0) の下で公開されています。

**改変は自由に行っていただいて構いません。**  ご自身のプロジェクトで利用したり、機能追加や修正を行うことは歓迎します。

**ただし、改変後のコードを別の場所で公開・配布することは、原則としてご遠慮ください。**

本リポジトリは、[あなたの名前/組織名] が [目的] のために作成し、公開しているものです。
改変したものを、あたかもご自身のオリジナル作品として公開・配布されることは、作者として意図しておりません。

もし、改変したものを公開したい特別な理由がある場合は、事前にご相談いただけると幸いです。

ご理解とご協力をお願いいたします。